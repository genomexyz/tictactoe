state = true;
var possible_move = [];
var history_move = [];
var your_score = 0;
var bot_score = 0;
var back = '<div class="game-space top left" id="1" onclick="execute(1)"></div>\
					<div class="game-space top" id="2" onclick="execute(2)"></div>\
					<div class="game-space top right" id="3" onclick="execute(3)"></div>\
					<div class="game-space left" id="4" onclick="execute(4)"></div>\
					<div class="game-space" id="5" onclick="execute(5)"></div>\
					<div class="game-space right" id="6" onclick="execute(6)"></div>\
					<div class="game-space bottom left" id="7" onclick="execute(7)"></div>\
					<div class="game-space bottom" id="8" onclick="execute(8)"></div>\
					<div class="game-space bottom right" id="9" onclick="execute(9)"></div>'
function execute(nilai)
{

	if (checkmove(nilai)) {
		domove(nilai);
//		console.log(history_move.join(""));

		if (state) {
			state = false;
		} else {
			state = true;
		}
		document.getElementById("game-board").innerHTML = "<h1>LOADING...</h1>";
		console.log(history_move);
		$.get("http://127.0.0.1:5000/ryan/think/"+history_move.join(""), function(data, status){
			remapping();
			var moving = data.split(",");
			if (moving[1] == 'win') {
				your_score = your_score + 1;
				document.getElementById("kondisi").innerHTML = "<h2>You Win</h2>";
				document.getElementById("your_score").innerHTML = String(your_score);
			} else if (moving[1] == 'lose') {
				bot_score = bot_score +1;
				document.getElementById("kondisi").innerHTML = "<h2>You Lose</h2>";
				document.getElementById("bot_score").innerHTML = String(bot_score);
			} else if (moving[1] == 'ongame') {
				document.getElementById("kondisi").innerHTML = "<h2>On Game</h2>";
			} else if (moving[1] == 'draw') {
				document.getElementById("kondisi").innerHTML = "<h2>Draw</h2>";
			}
			state = false;
			domove(parseInt(moving[0]));
			console.log(data)
			});
//		console.log(history_move);
	}
}

function domove(nilai)
{
	if (checkmove(nilai)) {
		if (state) {
			document.getElementById(String(nilai)).innerHTML = "X";
		} else {
			document.getElementById(String(nilai)).innerHTML = "O";
		}
		history_move.push(nilai);
		for(i = 0; i < possible_move.length; i++){ 
			if (possible_move[i] == nilai) {
				possible_move.splice(i, 1);
			}
		}
	}
}

function remapping()
{
//	console.log("remapping");
	document.getElementById("game-board").innerHTML = back;
	var bijih = "X"
	for (i = 0; i < history_move.length; i++) {
		if (i%2 == 0) {
			bijih = "X";
		} else {
			bijih = "O";
		}
		document.getElementById(String(history_move[i])).innerHTML = bijih;
		
	}
}


function checkmove(move)
{
	var ada = false;
	var x = true;
	for (i = 0; i < possible_move.length; i++) {
		if (move == possible_move[i]) {
			ada = true;
			break;
		}
	}
	return ada;
}

function reset_move()
{
	for (i = 1; i < 10; i++) {
		possible_move.push(i);
	}
	history_move = [];
	remapping();
	document.getElementById("kondisi").innerHTML = "<h2>On Game</h2>";
	state = true;
}

reset_move();
//var baseurl = document.getElementById("baseurl").innerHTML;


//$.get("http://127.0.0.1:5000/ryan/think/dragon_wing", function(data, status){alert("Data: " + data + "\nStatus: " + status)});
